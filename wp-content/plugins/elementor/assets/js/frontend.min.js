/*! Elementor Frontend - Functional Replacement for Static Sites */
!function () {
  "use strict";

  /* ------------------------------------------------------------------ */
  /*  elementorFrontend global                                          */
  /* ------------------------------------------------------------------ */
  var elemFront = {
    config: window.elementorFrontendConfig || {},
    isEditMode: function () { return false; },
    isWPPreviewMode: function () { return false; },
    getElements: function (key) {
      var map = {
        window: window,
        document: document,
        $window: jQuery(window),
        $document: jQuery(document)
      };
      return key ? map[key] : map;
    },
    getPageSettings: function () { return {}; },
    getCurrentDeviceMode: function () {
      var w = window.innerWidth;
      if (w <= 767) return "mobile";
      if (w <= 1024) return "tablet";
      return "desktop";
    },
    waypoint: function () {},
    hooks: {
      _store: {},
      addAction: function (tag, cb) {
        this._store[tag] = this._store[tag] || [];
        this._store[tag].push(cb);
      },
      doAction: function (tag) {
        (this._store[tag] || []).forEach(function (cb) { try { cb(); } catch (e) {} });
      }
    },
    on: function () {},
    utils: {
      urlActions: { actions: {} }
    }
  };
  window.elementorFrontend = elemFront;

  /* ------------------------------------------------------------------ */
  /*  Helper: parse data-settings JSON safely                           */
  /* ------------------------------------------------------------------ */
  function parseSettings(el) {
    var raw = el.getAttribute("data-settings");
    if (!raw) return {};
    try { return JSON.parse(raw); } catch (e) { return {}; }
  }

  /* ------------------------------------------------------------------ */
  /*  Boot on DOMContentLoaded                                          */
  /* ------------------------------------------------------------------ */
  document.addEventListener("DOMContentLoaded", function () {
    initSwiperCarousels();
    initCounters();
    initAnimations();
    initNestedTabs();
    initNestedAccordions();
    fireFrontendInit();
  });

  /* ================================================================== */
  /*  1. Swiper Image Carousels                                         */
  /* ================================================================== */
  function initSwiperCarousels() {
    if (typeof Swiper === "undefined") return;

    var wrappers = document.querySelectorAll(
      ".elementor-image-carousel-wrapper .swiper, " +
      ".elementor-image-carousel-wrapper .swiper-container"
    );

    wrappers.forEach(function (container) {
      var settings = parseSettings(container.closest("[data-settings]") || container);

      var slidesToShow    = parseInt(settings.slides_to_show, 10) || 3;
      var slidesToShowTab = parseInt(settings.slides_to_show_tablet, 10) || 2;
      var slidesToShowMob = parseInt(settings.slides_to_show_mobile, 10) || 1;
      var slidesToScroll  = parseInt(settings.slides_to_scroll, 10) || 1;
      var autoplay        = settings.autoplay !== "no" && settings.autoplay !== false;
      var autoplaySpeed   = parseInt(settings.autoplay_speed, 10) || 5000;
      var loop            = settings.infinite !== "no" && settings.infinite !== false;
      var speed           = parseInt(settings.speed, 10) || 500;
      var pauseOnHover    = settings.pause_on_hover !== "no";
      var effect          = settings.effect || "slide";
      var direction       = settings.direction || "horizontal";

      var swiperConfig = {
        slidesPerView: slidesToShow,
        slidesPerGroup: slidesToScroll,
        loop: loop,
        speed: speed,
        effect: effect,
        direction: direction,
        watchSlidesProgress: true,
        breakpoints: {
          0: {
            slidesPerView: slidesToShowMob,
            slidesPerGroup: 1
          },
          768: {
            slidesPerView: slidesToShowTab,
            slidesPerGroup: 1
          },
          1025: {
            slidesPerView: slidesToShow,
            slidesPerGroup: slidesToScroll
          }
        }
      };

      if (autoplay) {
        swiperConfig.autoplay = {
          delay: autoplaySpeed,
          disableOnInteraction: false,
          pauseOnMouseEnter: pauseOnHover
        };
      }

      /* Navigation arrows */
      var nextEl = container.querySelector(".elementor-swiper-button-next, .swiper-button-next");
      var prevEl = container.querySelector(".elementor-swiper-button-prev, .swiper-button-prev");
      if (nextEl || prevEl) {
        swiperConfig.navigation = {};
        if (nextEl) swiperConfig.navigation.nextEl = nextEl;
        if (prevEl) swiperConfig.navigation.prevEl = prevEl;
      }

      /* Pagination dots */
      var paginationEl = container.querySelector(".swiper-pagination");
      if (paginationEl) {
        swiperConfig.pagination = {
          el: paginationEl,
          type: "bullets",
          clickable: true
        };
      }

      try {
        new Swiper(container, swiperConfig);
      } catch (e) {
        console.warn("[Elementor] Swiper init failed:", e);
      }
    });
  }

  /* ================================================================== */
  /*  2. Counter Animation (jquery-numerator)                           */
  /* ================================================================== */
  function initCounters() {
    if (typeof jQuery === "undefined") return;

    var counters = document.querySelectorAll(".elementor-counter-number");
    if (!counters.length) return;

    /* If jquery-numerator is available, use it; otherwise fall-back */
    var hasNumerator = jQuery.fn && typeof jQuery.fn.numerator === "function";

    counters.forEach(function (el) {
      var toValue   = el.getAttribute("data-to-value") || el.textContent;
      var delimiter = el.getAttribute("data-delimiter") || ",";
      var duration  = parseInt(el.getAttribute("data-duration"), 10) || 2000;
      var fromValue = parseInt(el.getAttribute("data-from-value"), 10) || 0;

      /* Use IntersectionObserver so the animation fires on scroll-in */
      var observer = new IntersectionObserver(function (entries, obs) {
        entries.forEach(function (entry) {
          if (!entry.isIntersecting) return;
          obs.unobserve(entry.target);
          animateCounter(entry.target, fromValue, toValue, delimiter, duration, hasNumerator);
        });
      }, { threshold: 0.3 });

      observer.observe(el);
    });
  }

  function animateCounter(el, from, to, delimiter, duration, hasNumerator) {
    var numericTo = parseFloat(String(to).replace(/,/g, ""));
    if (isNaN(numericTo)) { el.textContent = to; return; }

    if (hasNumerator) {
      try {
        jQuery(el).numerator({
          toValue: numericTo,
          fromValue: from,
          duration: duration,
          delimiter: delimiter,
          rounding: String(to).indexOf(".") !== -1 ? (String(to).split(".")[1] || "").length : 0
        });
        return;
      } catch (e) { /* fall through to manual */ }
    }

    /* Manual fallback animation */
    var startTime = null;
    var isFloat = String(to).indexOf(".") !== -1;
    var decimals = isFloat ? (String(to).split(".")[1] || "").length : 0;

    function step(ts) {
      if (!startTime) startTime = ts;
      var progress = Math.min((ts - startTime) / duration, 1);
      var current = from + (numericTo - from) * progress;
      el.textContent = formatNumber(current, decimals, delimiter);
      if (progress < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  function formatNumber(n, decimals, delimiter) {
    var fixed = n.toFixed(decimals);
    if (!delimiter) return fixed;
    var parts = fixed.split(".");
    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, delimiter);
    return parts.join(".");
  }

  /* ================================================================== */
  /*  3. Entrance Animations (elementor-invisible -> animated)          */
  /* ================================================================== */
  function initAnimations() {
    var invisible = document.querySelectorAll(".elementor-invisible");
    if (!invisible.length) return;

    var observer = new IntersectionObserver(function (entries, obs) {
      entries.forEach(function (entry) {
        if (!entry.isIntersecting) return;
        obs.unobserve(entry.target);

        var el = entry.target;
        var settings = parseSettings(el) || {};

        /* _animation or animation field; Elementor uses both */
        var animName = settings._animation || settings.animation || settings._entrance_animation || "";
        var delay    = parseInt(settings._animation_delay, 10) || parseInt(settings.animation_delay, 10) || 0;

        if (!animName) {
          /* No explicit animation name -- just reveal */
          el.classList.remove("elementor-invisible");
          return;
        }

        setTimeout(function () {
          el.classList.remove("elementor-invisible");
          el.classList.add("animated", animName);
        }, delay);
      });
    }, { threshold: 0.15 });

    invisible.forEach(function (el) { observer.observe(el); });
  }

  /* ================================================================== */
  /*  4. Nested Tabs  (.e-n-tabs)                                       */
  /* ================================================================== */
  function initNestedTabs() {
    var tabWidgets = document.querySelectorAll(".e-n-tabs");

    tabWidgets.forEach(function (widget) {
      var titles   = widget.querySelectorAll(":scope > .e-n-tabs-heading .e-n-tab-title, :scope > .e-n-tabs-heading > .e-n-tab-title");
      var contents = widget.querySelectorAll(":scope > .e-n-tabs-content > .e-con");

      if (!titles.length) {
        /* Try alternate Elementor nested-tabs markup */
        titles   = widget.querySelectorAll(".e-n-tab-title");
        contents = widget.querySelectorAll(".e-n-tabs-content > .e-con");
      }

      /* Activate the first tab by default if none is active */
      var hasActive = false;
      titles.forEach(function (t) {
        if (t.classList.contains("e-active")) hasActive = true;
      });
      if (!hasActive && titles.length) {
        activateTab(titles, contents, 0);
      }

      titles.forEach(function (title, idx) {
        title.addEventListener("click", function (e) {
          e.preventDefault();
          activateTab(titles, contents, idx);
        });

        title.addEventListener("keydown", function (e) {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            activateTab(titles, contents, idx);
          }
        });
      });
    });
  }

  function activateTab(titles, contents, activeIdx) {
    titles.forEach(function (t, i) {
      if (i === activeIdx) {
        t.classList.add("e-active");
        t.setAttribute("aria-selected", "true");
        t.setAttribute("tabindex", "0");
      } else {
        t.classList.remove("e-active");
        t.setAttribute("aria-selected", "false");
        t.setAttribute("tabindex", "-1");
      }
    });
    contents.forEach(function (c, i) {
      if (i === activeIdx) {
        c.classList.add("e-active");
        c.style.display = "";
        c.removeAttribute("hidden");
      } else {
        c.classList.remove("e-active");
        c.style.display = "none";
        c.setAttribute("hidden", "");
      }
    });
  }

  /* ================================================================== */
  /*  5. Nested Accordions (.e-n-accordion)                             */
  /* ================================================================== */
  function initNestedAccordions() {
    var accordions = document.querySelectorAll(".e-n-accordion");

    accordions.forEach(function (accordion) {
      var items = accordion.querySelectorAll(".e-n-accordion-item");

      items.forEach(function (item) {
        var titleEl = item.querySelector(".e-n-accordion-item-title");
        if (!titleEl) return;

        titleEl.addEventListener("click", function (e) {
          e.preventDefault();

          var isOpen = item.classList.contains("e-open");

          /* Check if multiple open is allowed via data-settings on widget */
          var widgetSettings = parseSettings(accordion.closest("[data-settings]") || accordion);
          var multiOpen = widgetSettings.max_items_expended === "multiple" ||
                          widgetSettings.multiple_open === "yes";

          if (!multiOpen) {
            /* Close all siblings */
            items.forEach(function (sibling) {
              if (sibling !== item) {
                sibling.classList.remove("e-open");
                var sibContent = sibling.querySelector(".e-n-accordion-item-title");
                if (sibContent) sibContent.setAttribute("aria-expanded", "false");
              }
            });
          }

          if (isOpen) {
            item.classList.remove("e-open");
            titleEl.setAttribute("aria-expanded", "false");
          } else {
            item.classList.add("e-open");
            titleEl.setAttribute("aria-expanded", "true");
          }
        });

        titleEl.addEventListener("keydown", function (e) {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            titleEl.click();
          }
        });
      });
    });
  }

  /* ================================================================== */
  /*  6. Fire elementor/frontend/init                                   */
  /* ================================================================== */
  function fireFrontendInit() {
    /* jQuery event */
    if (typeof jQuery !== "undefined") {
      jQuery(window).trigger("elementor/frontend/init");
    }

    /* Hooks system */
    if (window.elementorFrontend && window.elementorFrontend.hooks) {
      window.elementorFrontend.hooks.doAction("elementor/frontend/init");
    }

    /* Dispatch native custom event */
    window.dispatchEvent(new CustomEvent("elementor/frontend/init"));
  }

}();
