/*! Astra Theme Frontend - Functional Replacement for Static Sites */
!function () {
  "use strict";

  /* Read the astra config variable that the theme inlines in the HTML */
  var astraConfig = window.astra || {};

  document.addEventListener("DOMContentLoaded", function () {
    initScrollToTop();
    initSmoothScrollAnchors();
    initMobileMenuToggle();
  });

  /* ================================================================== */
  /*  1. Scroll-to-Top Button                                           */
  /* ================================================================== */
  function initScrollToTop() {
    var btn = document.querySelector(
      "#ast-scroll-top, .ast-scroll-top-icon, .ast-scroll-to-top"
    );
    if (!btn) return;

    var scrollOffset = parseInt(astraConfig.scroll_top_offset, 10) || 300;

    /* Show / hide on scroll */
    function toggleVisibility() {
      if (window.pageYOffset > scrollOffset) {
        btn.classList.add("show");
        btn.style.opacity = "1";
        btn.style.visibility = "visible";
      } else {
        btn.classList.remove("show");
        btn.style.opacity = "0";
        btn.style.visibility = "hidden";
      }
    }

    var ticking = false;
    window.addEventListener("scroll", function () {
      if (!ticking) {
        requestAnimationFrame(function () { toggleVisibility(); ticking = false; });
        ticking = true;
      }
    }, { passive: true });

    toggleVisibility();

    /* Scroll to top on click */
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  }

  /* ================================================================== */
  /*  2. Smooth Scroll for Anchor Links                                 */
  /* ================================================================== */
  function initSmoothScrollAnchors() {
    document.addEventListener("click", function (e) {
      var link = e.target.closest('a[href*="#"]');
      if (!link) return;

      var href = link.getAttribute("href");
      if (!href || href === "#") return;

      /* Only handle same-page anchors */
      var url;
      try { url = new URL(href, window.location.href); } catch (_) { return; }
      if (url.origin !== window.location.origin || url.pathname !== window.location.pathname) return;

      var hash = url.hash;
      if (!hash || hash === "#") return;

      var target;
      try { target = document.querySelector(hash); } catch (_) { return; }
      if (!target) return;

      e.preventDefault();

      var headerHeight = 0;
      var stickyHeader = document.querySelector(
        ".ast-sticky-active, #ast-fixed-header, .ast-header-sticky-active"
      );
      if (stickyHeader) {
        headerHeight = stickyHeader.offsetHeight || 0;
      }

      var scrollSpeed = parseInt(astraConfig.scroll_to_id_speed, 10) || 800;
      var offset      = parseInt(astraConfig.scroll_to_id_offset, 10) || 0;

      var top = target.getBoundingClientRect().top + window.pageYOffset - headerHeight - offset;

      window.scrollTo({ top: top, behavior: "smooth" });

      /* Update hash without jumping */
      if (history.pushState) {
        history.pushState(null, null, hash);
      }
    });
  }

  /* ================================================================== */
  /*  3. Mobile Menu Toggle                                             */
  /* ================================================================== */
  function initMobileMenuToggle() {
    /* Astra uses .ast-mobile-menu-trigger-minimal, .menu-toggle, etc. */
    var toggleBtns = document.querySelectorAll(
      ".ast-mobile-menu-trigger-minimal, " +
      ".ast-button-wrap .menu-toggle, " +
      ".ast-header-menu-toggle, " +
      ".menu-toggle"
    );

    toggleBtns.forEach(function (btn) {
      btn.addEventListener("click", function (e) {
        e.preventDefault();

        var headerBar = btn.closest(".ast-mobile-header-wrap, .main-header-bar-wrap, .site-header, header");
        var menu;

        if (headerBar) {
          menu = headerBar.querySelector(
            ".ast-mobile-popup-drawer, " +
            ".main-header-menu, " +
            ".ast-mobile-popup-content, " +
            ".toggle-on, " +
            "nav"
          );
        }

        if (!menu) {
          menu = document.querySelector(
            ".ast-mobile-popup-drawer, .main-header-menu, .ast-mobile-popup-content"
          );
        }

        if (!menu) return;

        var isActive = btn.classList.contains("toggled") || btn.classList.contains("active");

        if (isActive) {
          btn.classList.remove("toggled", "active");
          btn.setAttribute("aria-expanded", "false");
          menu.classList.remove("toggled", "toggle-on", "ast-mobile-popup-open");
          menu.style.display = "none";
          document.body.classList.remove("ast-mobile-popup-enable", "ast-main-header-nav-open");
        } else {
          btn.classList.add("toggled", "active");
          btn.setAttribute("aria-expanded", "true");
          menu.classList.add("toggled", "toggle-on", "ast-mobile-popup-open");
          menu.style.display = "";
          document.body.classList.add("ast-mobile-popup-enable", "ast-main-header-nav-open");
        }
      });
    });

    /* Close drawer / popup on clicking the X button inside it */
    document.addEventListener("click", function (e) {
      var closeBtn = e.target.closest(".menu-toggle-close, .ast-mobile-popup-close");
      if (!closeBtn) return;
      e.preventDefault();

      var popup = closeBtn.closest(
        ".ast-mobile-popup-drawer, .ast-mobile-popup-content"
      );
      if (popup) {
        popup.classList.remove("toggled", "toggle-on", "ast-mobile-popup-open");
        popup.style.display = "none";
      }
      document.body.classList.remove("ast-mobile-popup-enable", "ast-main-header-nav-open");

      /* Also reset the toggle button state */
      toggleBtns.forEach(function (b) {
        b.classList.remove("toggled", "active");
        b.setAttribute("aria-expanded", "false");
      });
    });
  }

}();
